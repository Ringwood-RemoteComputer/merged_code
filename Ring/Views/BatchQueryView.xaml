<Window x:Class="Ring.Views.BatchQueryView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Batch Query Manager" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5"
        FontFamily="Segoe UI"
        FontSize="14">
    
    <Window.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- Modern Color Palette -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="#2196F3"/>
        <SolidColorBrush x:Key="PrimaryDarkBrush" Color="#1976D2"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#FF4081"/>
        <SolidColorBrush x:Key="BackgroundBrush" Color="#F5F5F5"/>
        <SolidColorBrush x:Key="SurfaceBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#212121"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#757575"/>
        <SolidColorBrush x:Key="DividerBrush" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#4CAF50"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#FF9800"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#F44336"/>
        
        <!-- Enhanced Button Styles with Shadows -->
        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect Color="#40000000" 
                                                Direction="270" 
                                                ShadowDepth="2" 
                                                BlurRadius="4" 
                                                Opacity="0.3"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource PrimaryDarkBrush}"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <TranslateTransform Y="-1"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource PrimaryDarkBrush}"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="{StaticResource DividerBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
        </Style>
        
        <!-- GroupBox Style -->
        <Style x:Key="ModernGroupBoxStyle" TargetType="GroupBox">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DividerBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid>
                            <Border Background="{TemplateBinding Background}" 
                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                    BorderThickness="{TemplateBinding BorderThickness}" 
                                    CornerRadius="4"/>
                            <StackPanel>
                                <TextBlock Text="{TemplateBinding Header}" 
                                         FontWeight="{TemplateBinding FontWeight}"
                                         Foreground="{TemplateBinding Foreground}"
                                         Margin="12,8,12,0"/>
                                <ContentPresenter Margin="{TemplateBinding Padding}"/>
                            </StackPanel>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- TextBox Style -->
        <Style x:Key="ModernTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DividerBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                        Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- ComboBox Style -->
        <Style x:Key="ModernComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DividerBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
        
        <!-- DatePicker Style -->
        <Style x:Key="ModernDatePickerStyle" TargetType="DatePicker">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DividerBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
        
        <!-- Enhanced DataGrid Style -->
        <Style x:Key="ModernDataGridStyle" TargetType="DataGrid">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DividerBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="{StaticResource DividerBrush}"/>
            <Setter Property="VerticalGridLinesBrush" Value="Transparent"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="CanUserReorderColumns" Value="True"/>
            <Setter Property="CanUserResizeColumns" Value="True"/>
            <Setter Property="CanUserSortColumns" Value="True"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="AlternatingRowBackground" Value="#FAFAFA"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="RowHeight" Value="32"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGrid">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="4">
                            <Border.Effect>
                                <DropShadowEffect Color="#20000000" 
                                                Direction="270" 
                                                ShadowDepth="1" 
                                                BlurRadius="3" 
                                                Opacity="0.2"/>
                            </Border.Effect>
                            <ScrollViewer x:Name="DG_ScrollViewer" 
                                        Focusable="false">
                                <ScrollViewer.Template>
                                    <ControlTemplate TargetType="ScrollViewer">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <Button Command="{x:Static DataGrid.SelectAllCommand}" 
                                                    Focusable="false" 
                                                    Visibility="{Binding HeadersVisibility, Converter={x:Static DataGrid.HeadersVisibilityConverter}, ConverterParameter={x:Static DataGridHeadersVisibility.All}}" 
                                                    Width="{Binding CellsPanelHorizontalOffset}" 
                                                    Grid.Column="0" 
                                                    Grid.Row="0"/>
                                            
                                            <DataGridColumnHeadersPresenter x:Name="PART_ColumnHeadersPresenter" 
                                                                           Grid.Column="1" 
                                                                           Grid.Row="0" 
                                                                           Visibility="{Binding HeadersVisibility, Converter={x:Static DataGrid.HeadersVisibilityConverter}, ConverterParameter={x:Static DataGridHeadersVisibility.Column}}"/>
                                            
                                            <ScrollContentPresenter x:Name="PART_ScrollContentPresenter" 
                                                                  Grid.ColumnSpan="2" 
                                                                  Grid.Column="0" 
                                                                  Grid.Row="1" 
                                                                  Content="{TemplateBinding Content}" 
                                                                  ContentTemplate="{TemplateBinding ContentTemplate}"/>
                                            
                                            <ScrollBar x:Name="PART_VerticalScrollBar" 
                                                      Orientation="Vertical" 
                                                      Grid.Column="2" 
                                                      Grid.Row="1" 
                                                      Maximum="{TemplateBinding ScrollableHeight}" 
                                                      ViewportSize="{TemplateBinding ViewportHeight}" 
                                                      Value="{Binding VerticalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}" 
                                                      Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                                            
                                            <Grid Grid.Column="1" Grid.Row="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="{Binding NonFrozenColumnsViewportHorizontalOffset, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <ScrollBar x:Name="PART_HorizontalScrollBar" 
                                                          Orientation="Horizontal" 
                                                          Grid.Column="1" 
                                                          Maximum="{TemplateBinding ScrollableWidth}" 
                                                          ViewportSize="{TemplateBinding ViewportWidth}" 
                                                          Value="{Binding HorizontalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}" 
                                                          Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}"/>
                                            </Grid>
                                        </Grid>
                                    </ControlTemplate>
                                </ScrollViewer.Template>
                                <ItemsPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Loading Indicator Style -->
        <Style x:Key="LoadingIndicatorStyle" TargetType="Border">
            <Setter Property="Background" Value="#80000000"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="16"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Modern Header with Company Branding -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Left Side - Title and Location -->
                <StackPanel Grid.Column="0" Margin="24,20,0,20">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Batch Query Report" 
                                 FontSize="28" 
                                 FontWeight="Bold" 
                                 Foreground="White"
                                 VerticalAlignment="Center"/>
                        <Border Background="#FFD700" 
                                CornerRadius="12" 
                                Padding="8,4" 
                                Margin="12,0,0,0"
                                VerticalAlignment="Center">
                            <TextBlock Text="RS3000" 
                                     FontSize="12" 
                                     FontWeight="Bold" 
                                     Foreground="#1976D2"/>
                        </Border>
                    </StackPanel>
                    <TextBlock Text="CTC -- Waco, TX" 
                             FontSize="16" 
                             Foreground="White" 
                             Opacity="0.9"/>
                </StackPanel>
                
                <!-- Right Side - Report Info -->
                <StackPanel Grid.Column="1" Margin="0,20,24,20" HorizontalAlignment="Right">
                    <TextBlock Text="{Binding ReportDateTime, StringFormat='Print Date / Time: {0:MM/dd/yyyy h:mm tt}'}" 
                             FontSize="12" 
                             Foreground="White" 
                             Opacity="0.9"
                             HorizontalAlignment="Right"/>
                    <TextBlock Text="{Binding PageInfo, StringFormat='Page: {0}'}" 
                             FontSize="12" 
                             Foreground="White" 
                             Opacity="0.9"
                             HorizontalAlignment="Right"
                             Margin="0,2,0,0"/>
                    <Border Background="#000000" 
                            BorderBrush="#FFD700" 
                            BorderThickness="2" 
                            CornerRadius="4" 
                            Padding="8,4" 
                            Margin="0,8,0,0">
                        <TextBlock Text="| Ringwood" 
                                 FontSize="12" 
                                 FontWeight="Bold" 
                                 Foreground="#FFD700"
                                 HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Enhanced Search Filters with Modern Design -->
        <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" 
                BorderBrush="{StaticResource DividerBrush}" 
                BorderThickness="0,1,0,0" 
                Margin="0,0,0,0">
            <Grid Margin="24,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Filter Title with Icon -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                    <Border Background="{StaticResource PrimaryBrush}" 
                            CornerRadius="16" 
                            Width="32" 
                            Height="32" 
                            Margin="0,0,12,0">
                        <TextBlock Text="&#x1F50D;" 
                                 FontSize="16" 
                                 HorizontalAlignment="Center" 
                                 VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock Text="Search &amp; Filter Criteria"
                             FontSize="18" 
                             FontWeight="SemiBold" 
                             Foreground="{StaticResource TextPrimaryBrush}"
                             VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Filter Controls -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Date Range -->
                    <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,12,16">
                        <TextBlock Text="Start Date" 
                                 FontWeight="SemiBold" 
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 Margin="0,0,0,6"/>
                        <DatePicker x:Name="StartDatePicker" 
                                  Style="{StaticResource ModernDatePickerStyle}"
                                  SelectedDate="{Binding StartDate, UpdateSourceTrigger=PropertyChanged}"
                                  Height="36"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Row="0" Grid.Column="1" Margin="12,0,12,16">
                        <TextBlock Text="End Date" 
                                 FontWeight="SemiBold" 
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 Margin="0,0,0,6"/>
                        <DatePicker x:Name="EndDatePicker" 
                                  Style="{StaticResource ModernDatePickerStyle}"
                                  SelectedDate="{Binding EndDate, UpdateSourceTrigger=PropertyChanged}"
                                  Height="36"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Row="0" Grid.Column="2" Margin="12,0,12,16">
                        <TextBlock Text="Formula Number" 
                                 FontWeight="SemiBold" 
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 Margin="0,0,0,6"/>
                        <ComboBox x:Name="FormulaComboBox" 
                                Style="{StaticResource ModernComboBoxStyle}"
                                ItemsSource="{Binding AvailableFormulaNumbers}"
                                SelectedItem="{Binding CurrentFilter.FormulaNumber, UpdateSourceTrigger=PropertyChanged}"
                                DisplayMemberPath="."
                                IsEditable="True"
                                Text="All Formulas"
                                Height="36"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Row="0" Grid.Column="3" Margin="12,0,0,16">
                        <TextBlock Text="Storage Tank" 
                                 FontWeight="SemiBold" 
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 Margin="0,0,0,6"/>
                        <ComboBox x:Name="TankComboBox" 
                                Style="{StaticResource ModernComboBoxStyle}"
                                ItemsSource="{Binding AvailableStorageTankNumbers}"
                                SelectedItem="{Binding CurrentFilter.StorageTankNumber, UpdateSourceTrigger=PropertyChanged}"
                                DisplayMemberPath="."
                                IsEditable="True"
                                Text="All Tanks"
                                Height="36"/>
                    </StackPanel>
                    
                    <!-- Search Text -->
                    <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,12,0">
                        <TextBlock Text="Search Text" 
                                 FontWeight="SemiBold" 
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 Margin="0,0,0,6"/>
                        <TextBox x:Name="SearchTextBox" 
                               Style="{StaticResource ModernTextBoxStyle}"
                               Text="{Binding CurrentFilter.SearchText, UpdateSourceTrigger=PropertyChanged}"
                               Height="36"
                               FontSize="14"/>
                    </StackPanel>
                    
                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="1" Grid.Column="2" Grid.ColumnSpan="3" 
                              Orientation="Horizontal" 
                              HorizontalAlignment="Right" 
                              VerticalAlignment="Bottom">
                        <Button x:Name="SearchButton" 
                              Content="Search" 
                              Style="{StaticResource ModernButtonStyle}"
                              Command="{Binding SearchCommand}"
                              Width="120"
                              Height="36"
                              FontSize="14"/>
                        <Button x:Name="ClearButton" 
                              Content="Clear" 
                              Style="{StaticResource SecondaryButtonStyle}"
                              Command="{Binding ClearFilterCommand}"
                              Width="120"
                              Height="36"
                              FontSize="14"
                              Margin="8,0,0,0"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
        
        <!-- Enhanced Data Grid with Report-like Design -->
        <Border Grid.Row="2" Background="{StaticResource SurfaceBrush}" 
                BorderBrush="{StaticResource DividerBrush}" 
                BorderThickness="0,1,0,0" 
                Margin="0,0,0,0">
            <Grid Margin="24,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Report Header with Batch Information -->
                <Border Grid.Row="0" Background="#FFD700" 
                        BorderBrush="#000000" 
                        BorderThickness="2" 
                        CornerRadius="4" 
                        Margin="0,0,0,16">
                    <Grid Margin="16,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                 Text="Batch Information" 
                                 FontSize="16" 
                                 FontWeight="Bold" 
                                 Foreground="#000000"
                                 VerticalAlignment="Center"/>
                        
                        <TextBlock Grid.Column="1" 
                                 Text="{Binding Batches.Count, StringFormat='Batch Report: {0}'}" 
                                 FontSize="16" 
                                 FontWeight="Bold" 
                                 Foreground="#000000"
                                 VerticalAlignment="Center"/>
                    </Grid>
                </Border>
                
                <!-- Data Grid -->
                <Border Grid.Row="1" 
                        Background="{StaticResource SurfaceBrush}" 
                        BorderBrush="{StaticResource DividerBrush}" 
                        BorderThickness="1" 
                        CornerRadius="4">
                    <Grid>
                        <DataGrid x:Name="BatchDataGrid" 
                                Style="{StaticResource ModernDataGridStyle}"
                                ItemsSource="{Binding Batches}"
                                SelectedItem="{Binding SelectedBatch}"
                                AutoGenerateColumns="False"
                                Margin="0">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" 
                                                  Binding="{Binding Id}" 
                                                  Width="60" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="Formula Name" 
                                                  Binding="{Binding FormulaName}" 
                                                  Width="180" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="Formula Number" 
                                                  Binding="{Binding FormulaNumber}" 
                                                  Width="100" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="Start Date" 
                                                  Binding="{Binding StartDate, StringFormat=MM/dd/yyyy}" 
                                                  Width="100" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="Start Time" 
                                                  Binding="{Binding StartTime, StringFormat=hh\\:mm\\:ss}" 
                                                  Width="80" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="End Date" 
                                                  Binding="{Binding EndDate, StringFormat=MM/dd/yyyy}" 
                                                  Width="100" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="End Time" 
                                                  Binding="{Binding EndTime, StringFormat=hh\\:mm\\:ss}" 
                                                  Width="80" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="Storage Tank" 
                                                  Binding="{Binding StorageTankName}" 
                                                  Width="120" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="Volume (Gal)" 
                                                  Binding="{Binding Volume, StringFormat=F2}" 
                                                  Width="90" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="Temperature (°C)" 
                                                  Binding="{Binding Temperature, StringFormat=F1}" 
                                                  Width="100" 
                                                  IsReadOnly="True"/>
                                <DataGridTextColumn Header="Status" 
                                                  Binding="{Binding StatusText}" 
                                                  Width="100" 
                                                  IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <!-- Loading Overlay -->
                        <Border x:Name="LoadingOverlay" 
                              Style="{StaticResource LoadingIndicatorStyle}"
                              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="Loading..." 
                                         Foreground="White" 
                                         FontSize="16" 
                                         FontWeight="SemiBold" 
                                         HorizontalAlignment="Center"/>
                                <ProgressBar IsIndeterminate="True" 
                                           Width="200" 
                                           Height="4" 
                                           Margin="0,8,0,0"
                                           Foreground="White"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Border>
        
        <!-- Modern Actions Section -->
        <Border Grid.Row="3" Background="{StaticResource SurfaceBrush}" 
                BorderBrush="{StaticResource DividerBrush}" 
                BorderThickness="0,1,0,0" 
                Margin="0,0,0,0">
            <Grid Margin="24,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Actions Title with Icon -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                    <Border Background="{StaticResource AccentBrush}" 
                            CornerRadius="16" 
                            Width="32" 
                            Height="32" 
                            Margin="0,0,12,0">
                        <TextBlock Text="⚡" 
                                 FontSize="16" 
                                 HorizontalAlignment="Center" 
                                 VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock Text="Report Actions" 
                             FontSize="18" 
                             FontWeight="SemiBold" 
                             Foreground="{StaticResource TextPrimaryBrush}"
                             VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Action Buttons -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button x:Name="ExportExcelButton" 
                          Content="Export to Excel" 
                          Style="{StaticResource ModernButtonStyle}"
                          Command="{Binding ExportToExcelCommand}"
                          Width="160"
                          Height="40"
                          FontSize="14"
                          Margin="0,0,8,0"/>
                    <Button x:Name="ExportPdfButton" 
                          Content="Export to PDF" 
                          Style="{StaticResource ModernButtonStyle}"
                          Command="{Binding ExportToPdfCommand}"
                          Width="160"
                          Height="40"
                          FontSize="14"
                          Margin="4,0"/>
                    <Button x:Name="PrintButton" 
                          Content="Print" 
                          Style="{StaticResource ModernButtonStyle}"
                          Command="{Binding PrintCommand}"
                          Width="120"
                          Height="40"
                          FontSize="14"
                          Margin="4,0"/>
                    <Button x:Name="TestPrintButton" 
                          Content="Test Print" 
                          Style="{StaticResource SecondaryButtonStyle}"
                          Click="TestPrintButton_Click"
                          Width="120"
                          Height="40"
                          FontSize="14"
                          Margin="4,0"/>
                    <Button x:Name="RefreshButton" 
                          Content="Refresh" 
                          Style="{StaticResource SecondaryButtonStyle}"
                          Command="{Binding RefreshCommand}"
                          Width="120"
                          Height="40"
                          FontSize="14"
                          Margin="4,0"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Enhanced Status Bar -->
        <Border Grid.Row="4" Background="{StaticResource SurfaceBrush}" 
              BorderBrush="{StaticResource DividerBrush}" 
              BorderThickness="0,1,0,0" 
              Padding="24,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Status Message -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Background="{StaticResource PrimaryBrush}" 
                            CornerRadius="12" 
                            Width="24" 
                            Height="24" 
                            Margin="0,0,8,0">
                        <TextBlock Text="i" 
                                 FontSize="12" 
                                 HorizontalAlignment="Center" 
                                 VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock x:Name="StatusTextBlock" 
                             Text="{Binding StatusMessage}" 
                             Foreground="{StaticResource TextSecondaryBrush}"
                             VerticalAlignment="Center"
                             FontSize="14"/>
                </StackPanel>
                
                <!-- Record Count -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0">
                    <TextBlock Text="Records: " 
                             Foreground="{StaticResource TextSecondaryBrush}"
                             VerticalAlignment="Center"
                             FontSize="14"/>
                    <Border Background="{StaticResource SuccessBrush}" 
                            CornerRadius="12" 
                            Padding="8,4">
                        <TextBlock Text="{Binding Batches.Count}" 
                                 Foreground="White"
                                 FontWeight="Bold"
                                 VerticalAlignment="Center"
                                 FontSize="14"/>
                    </Border>
                </StackPanel>
                
                <!-- System Info -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="16,0,0,0">
                    <TextBlock Text="System: " 
                             Foreground="{StaticResource TextSecondaryBrush}"
                             VerticalAlignment="Center"
                             FontSize="14"/>
                    <TextBlock Text="Ringwood RS3000" 
                             Foreground="{StaticResource TextPrimaryBrush}"
                             FontWeight="SemiBold"
                             VerticalAlignment="Center"
                             FontSize="14"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
